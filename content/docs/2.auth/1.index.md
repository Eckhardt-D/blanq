---
title: "Authentication"
description: "Authentication Documentation"
---

# Authentication

Blanq uses the amazing [Better Auth](https://better-auth.com) for authentication. This is a service that provides a lot of the boilerplate for authentication and user management.
If these docs are missing info on auth, look at the [Better Auth Docs](https://www.better-auth.com/docs/integrations/nuxt).

## The User Object

Currently the base user schema is simple and contains only the necessary fields for Better Auth to function.

```typescript
export const users = sqliteTable('users', {
  id: uuid,
  name: text('name').notNull(),
  email: text('email').unique().notNull(),
  emailVerified: integer('email_verified', { mode: 'boolean' }).default(false).notNull(),
  stripeCustomerId: text('stripe_customer_id').unique(),
  image: text('image'),
  createdAt: created_at,
  updatedAt: updated_at,
  deletedAt: deleted_at,
}, table => [
  index('users_created_non_deleted_idx').on(table.createdAt).where(isNull(table.deletedAt)),
  index('users_stripe_id_idx').on(table.stripeCustomerId),
])
```

### Built-in augmentations

In the `server/utils/auth.ts` file you will find the usage of a plugin called customSession, which adds a propery called subscription
to the User object so that the app can have information about the user's active and cancelled subscriptions. It has the following type:

```typescript
export interface SubscriptionInfo {
  isSubscribed: boolean
  activeSubscriptionPlans: {
    stripeMainPriceId: string
    currentPeriodEnd: Date
    status: 'active'
  }[]
  cancelledSubscriptionPlans: {
    stripeMainPriceId: string
    currentPeriodEnd: Date
    status: 'cancelled'
  }[]
}
```

This is used to display the badge next to the branding, show the user their active subs on the billing page and also to show
a message under the products that the user has plans that will be cancelled soon. So they can manage it in Portal. See [Payments](/docs/payments) for more info.

### Extending the User Object

If you need to add more fields to the user object, you can do so in the `server/database/schemas/users.ts` file.
Once you've added your new field you can run:

```bash
bun db:generate
```

To generate the SQL migration file. Then finally, you need to update the `server/utils/auth.ts` file to include the new field:

For example, this is how the `stripeCustomerId` field is added (note how `input` is false, so users can't update this field):

```typescript
function createAuth() {
  return betterAuth({
    user: {
      additionalFields: {
        stripeCustomerId: {
          type: 'string',
          input: false,
        },
      },
...
```

> Note, there is currently a bug with TypeScript inference when using additional fields

### Additional fields not being typed

Currently there is a small workaround needed in `lib/auth-client.ts` where you need to manually add the type for the additional field:

And in `server/utils/auth.ts` you need to manually add the type of the custom session field in the `User` interface.

